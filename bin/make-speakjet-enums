#!/usr/bin/perl -W

opendir BANK7, "Source/Banks/Bank07" or die;

`mkdir -p Source/Generated/Common/ Source/Generated/Bank07`;

open COMMON, '>', 'Source/Generated/Common/SpeakJetIDs.s' or die;
open INDEX, '>', 'Source/Generated/Bank07/SpeakJetIndex.s' or die;

print COMMON <<END;
;;; Source/Generated/Common/SpeakJetIDs.s
;;; generated from all Speech includes files
;;;
;;; These IDs are used to command various utterances
;;; to occur from the speech engine in Bank 7

END

print INDEX ';;; Source/Generated/Bank07/SpeakJetIndex.s
;;; generated from all Speech includes files
;;;
;;; This matches SpeakJetIDs.s in order but
;;; maps to actual addresses

SpeechIndex = ($0000';

$n = 1; # because $00 means "no speech"

while (my $dirent = readdir BANK7) {
  next unless $dirent =~ /(.*)Speech.txt/;

  open INFILE, '<', "Source/Banks/Bank07/$dirent";
  while (my $line = <INFILE>) {
    next unless $line =~ /^\s*([A-Za-z0-9_]+):/;

    my $label = $1;
    printf COMMON "\n\tPhrase_%s := \$%02x", $label, $n++;
    print INDEX ", Speech_$label";
  };
};

print COMMON "\n\n;;; End of SpeakJet enums\n";
print INDEX ")

SpeechIndexH:
	.byte >SpeechIndex
SpeechIndexL:
	.byte <SpeechIndex

	SpeechCount = len(SpeechIndex)

;;; End of SpeakJet index\n";

close INDEX;
close COMMON;
closedir BANK7;
